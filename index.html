
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>EL DORADO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="lyt">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="EL DORADO">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="EL DORADO">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="EL DORADO">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="EL DORADO" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="EL DORADO" title="EL DORADO"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="EL DORADO">EL DORADO</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/21/What-is-the-actual-role-of-ZooKeeper-in-Kafka/" title="What is the actual role of ZooKeeper in Kafka" itemprop="url">What is the actual role of ZooKeeper in Kafka</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-11-21T08:38:05.000Z" itemprop="datePublished"> 发表于 2015-11-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>本文翻译自Quora一则提问， 原文链接: <a href="https://www.quora.com/What-is-the-actual-role-of-ZooKeeper-in-Kafka" target="_blank" rel="external">https://www.quora.com/What-is-the-actual-role-of-ZooKeeper-in-Kafka</a></p>
<p>要理解Kafka内部是如何使用ZooKeeper，我们首先要了解ZooKeeper。下面我将尝试直观的解释ZooKeeper如何工作。我将尽我所能，避免使用技术用语，并保持简单。</p>
<h2 id="1-_At_a_High_level">1. At a High level</h2><p>首先，ZooKeeper肯定是一个客户端可以连接到的<strong>服务</strong>。它提供了一个树状结构（ZooKeeper文档称之为<strong>分层命名空间</strong>），以便客户端访问。那么，我们为什么需要这棵树？当然是为了存储数据，因此这棵树被称作”data tree”. 在这棵树上，你可以做整套CRUD操作。它采用标准UNIX文件路径表示法。例如，我们使用 /A/B/C 表示C这个zNode节点的路径，其中B是C的父节点，而同理A是B的父节点。<br>下面是一个例子：</p>
<p><img src="/img/What-is-the-actual-role-of-ZooKeeper-in-Kafka/01.png" alt=""></p>
<p>这看起来很像一个UNIX文件系统对吧？下面是若干定义</p>
<ol>
<li>每个节点称为<strong>zNode</strong></li>
<li>每个zNode在树中由<strong>PATH</strong>标示 </li>
<li>zNode有两种类型 –<strong>persistent(持久节点)</strong> 和 <strong>ephemeral(临时节点)</strong></li>
<li>每个zNode里可以存储值数据，zNode可以有子节点</li>
<li>zNodes一旦创建不可以重命名</li>
<li>可以在zNode上添加/删除<strong>WATCH</strong></li>
</ol>
<p>有人说ZooKeeper的API过于基础，应当基于它做一些Recipes封装。可以看一下由Netflix编写的Curator框架（目前已贡献给Apache），Curator替我们解决了很多问题。</p>
<p>另外，WATCH是一个很有趣的组件，你可以为某个zNode添加WATCH，当某些事件发生的时候会得到通知。比如它可以订阅某个路径上数据的变更。</p>
<font color="red">注: Recipe 词典的意思是食谱,配方,美食菜谱,烹饪法， 延伸用法：某项计划或步骤来取得预先给定的结果。 在计算机领域没有合适的汉语对应，如果把ZooKeeper看成菜的话，recipe就相当于菜谱， 比如麻婆豆腐， 宫保鸡丁。个人认为Recipes在这里指Leader选举、分布式锁、分布式事物等ZooKeeper常见用途的封装。</font>

<h2 id="2-_One_level_deeper">2. One level deeper</h2><p>让我们看一下另一个例子，它的目的是基于键值对格式将若干配置信息保存起来，并在整个集群中可用。这些键值对应该持久化于磁盘，并且应该保证高可用、冗余和容错。而ZooKeeper正是为此而生。</p>
<p><img src="/img/What-is-the-actual-role-of-ZooKeeper-in-Kafka/02.png" alt=""></p>
<p>如果想尝试一番，现在可以将ZooKeeper安装到本地，进入其bin目录，运行如下命令：</p>
<blockquote>
<p>zkCli.sh –server 127.0.0.1:2181</p>
</blockquote>
<p>你可以看到一些提示信息，最后如下：</p>
<blockquote>
<p>[zk: 127.0.0.1:2181(CONNECTED) 1] </p>
</blockquote>
<p>继续尝试如下命令：<br><img src="/img/What-is-the-actual-role-of-ZooKeeper-in-Kafka/bash.png" alt=""></p>
<p>一旦zNode被创建，你可以使用GET或SET操作，将其当做分布式KV存储或hashmap来使用。<br>你也可以安装netflix exhibitor，它是一个基于UI的ZooKeeper管理面板，可以使用它可视化观察ZooKeeper中的数据。</p>
<h2 id="3-_Now_how_Kafka_uses_ZooKeeper?">3. Now how Kafka uses ZooKeeper?</h2><p>Kafka于v0.8版本使用ZooKeeper保存各种配置数据，并以分布式方式在整个集群中访问。观察如下两个简单用例中，Kafka如何将数组组织于ZooKeeper</p>
<ol>
<li>Topics under a broker -/brokers/topics/[topic] </li>
<li>Next Offset for a Consumer/Topic/Partition combination - /consumers/[groupId]/offsets/[topic]/[partitionId]</li>
</ol>
<p><img src="/img/What-is-the-actual-role-of-ZooKeeper-in-Kafka/03.png" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Kafka/">Kafka</a><a href="/tags/ZooKeeper/">ZooKeeper</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/06/使用rhcs创建高可用服务/" title="使用rhcs创建高可用服务" itemprop="url">使用rhcs创建高可用服务</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-08-06T08:12:35.000Z" itemprop="datePublished"> 发表于 2015-08-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>本文以adxp-agent节点为例，演示如何基于<strong>rhcs</strong>创建高可用的服务。假设读者已经搭建好<strong>rhcs</strong>环境。</p>
<h2 id="配置高可用集群：">配置高可用集群：</h2><p>打开luci登录界面, 点击create, 创建集群</p>
<p>在下面的五个选项中，“Download packages”表示在线下载并自动安装RHCS软件包，而“Use locally installed packages”表示用本地安装包进行安装。大多数情况下，RHCS组件包在集群搭建时已经手动安装完成，所以这里选择本地安装。</p>
<p>剩下两个复选框分别是启用共享存储支持（Enable Shared Storage Support）、节点加入集群时重启系统（Reboot nodes before joining cluster）这些创建cluster的设置，可选可不选，这里不做任何选择。<br><img src="/img/rhcs/rhcs-01.png" alt="新建集群界面"></p>
<p>点击create cluster按钮完成集群配置。若创建成功，下图可以浏览集群各节点状态<br><img src="/img/rhcs/rhcs-02.jpg" alt="集群状态"></p>
<p>进入Fence Devices页签创建 fence 设备，此处为了演示随意建一个。实际生产环境中，必须使用 fence 硬件设备。（这里根据客户的具体情况决定）<br><img src="/img/rhcs/rhcs-03.png" alt="添加Fence Device"></p>
<blockquote>
<p>以上属于<strong>rhcs</strong>平台搭建环节，故简述。</p>
</blockquote>
<p>Failover Domain是配置集群的失败转移域，通过失败转移域可以将服务和资源的切换限制在指定的节点间。<br>比如可以指定a001, a002, a003三台机器作为mysql的失败转移域。部署后若某台节点上的mysql出现不可用，就会在这几个节点之间切换。下面具体说明：</p>
<p>下图操作将创建adxp服务的失败转移域，其参数如下：<br>? Name：创建的失败转移域名称，起一个易记的名字即可。<br>? Prioritized：是否在Failover domain 中启用域成员优先级设置，这里选择启用。<br>? Restricted:表示是否在失败转移域成员中启用服务故障切换限制。<br>? No failback：表示在这个域中使用故障切回功能，也就是说，主节点故障时，备用节点会自动接管主节点服务和资源，当主节点恢复正常时，集群的服务和资源会从备用节点自动切换到主节点。（这里保持默认：不回切）</p>
<p>然后，在Member复选框中，选择加入此域的节点，这里选择的是n62和n61节点，然后在“priority”处设置优先级。越小优先级越高。<br>所有设置完成，点击Submit按钮。<br><img src="/img/rhcs/rhcs-04.png" alt="添加Failover Domain"></p>
<p>Resources是集群的核心，主要包含服务脚本、IP地址、文件系统等</p>
<ul>
<li>对于adxp-monitor, 只需配置一项Resource即可，即monitor自身</li>
<li>对于adxp-agent节点，需要添加agent运行过程中所需的所有服务（共三项，分别为h2数据库，aetl-server与adxp-agent应用）</li>
</ul>
<p>下图演示创建adxp-agent节点所需的三项Resource。首先是添加aetl资源的配置界面，其参数如下：<br>? Name：Resource名称<br>? Full Path to Script File：指向对应脚本的绝对路径，脚本已附带在产品包之中。（各个节点要将产品包部署到同一位置）<br><img src="/img/rhcs/rhcs-05.png" alt="添加Resource"></p>
<p>除aetl之外，继续向集群中添加adxp-agent所需的h2与agent资源，如下图：<br><img src="/img/rhcs/rhcs-06.png" alt="添加Resource"></p>
<p>最后也是最终的一步，添加服务组：<br>    新建服务组，引入刚才新建的三个资源(agent, etl, h2)在一个服务组内，可通过添加一个resource（包含两个child resource）的方式。</p>
<p>主要配置项如下：<br>? Service Name：服务组名称，起一个易记的名字即可。<br>? Failover Domain：失败转移域，服务与资源将在此域中的节点切换。<br>? Recovery Policy: 恢复策略，主要有重启（原节点restart尝试）与重分配（切换节点）<br><img src="/img/rhcs/rhcs-07.png" alt="添加Service Group"></p>
<p>所有服务添加完成后，如果应用程序设置正确，服务将自动启动。在Service Groups中可以看到服务组的启动状态，正常情况下，会显示当前服务运行所在节点。<br><img src="/img/rhcs/rhcs-08.png" alt="Service Group状态"></p>
<h2 id="高可用性验证测试：">高可用性验证测试：</h2><ol>
<li>部署完成后在一个节点A</li>
<li>登录A节点机器，通过脚本对某服务运行stop命令或者直接kill pid</li>
<li>观察luci是否能重新拉起应用（restart或relocate到另一机器上）</li>
<li>另外留意：同一个服务组内，一个应用/服务的挂掉会触发组内所有应用/服务的Recovery行为</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/04/Intellij-Idea-快捷键/" title="Intellij IDEA入门与进阶--1: 快捷键篇" itemprop="url">Intellij IDEA入门与进阶--1: 快捷键篇</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-06-04T05:59:55.000Z" itemprop="datePublished"> 发表于 2015-06-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>这篇文章整理了若干Intellij IDEA 的常用快捷键与相关的简要说明，基于 windows 下Intellij IDEA 14 中default键位进行测试。</p>
</blockquote>
<h5 id="导航">导航</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>快速打开类</td>
<td>Ctrl + N</td>
<td>可以打开类时直接跳转到某行，如String:123</td>
<td></td>
</tr>
<tr>
<td></td>
<td>快速打开指定文件或目录</td>
<td>Ctrl + Shift + N</td>
<td>同上，支持简单通配符、驼峰式命名、包名前缀</td>
<td></td>
</tr>
<tr>
<td></td>
<td>快速打开指定符号(symbol)</td>
<td>Ctrl + Shift + Alt + N</td>
<td>同上，均属于Go to a xxx系列</td>
<td></td>
</tr>
<tr>
<td></td>
<td>结构菜单</td>
<td>Ctrl + F12</td>
<td>如.java文件的成员变量与方法</td>
<td></td>
</tr>
<tr>
<td></td>
<td>显示最近编辑文件</td>
<td>Ctrl + E</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>切换指定的工具窗口</td>
<td>Alt + 数字</td>
<td>记住下面这几个常用的:</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Alt + 1</td>
<td>Project窗口</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Alt + 6</td>
<td>TODO窗口</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Alt + F12</td>
<td>Terminal窗口</td>
<td></td>
</tr>
<tr>
<td></td>
<td>跳转至关联的单元测试</td>
<td>Ctrl + Shift + T</td>
<td>如果在使用这一功能的类没有相关联的测试，IntelliJ可以帮你生成一个</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="文件内导航">文件内导航</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>最后编辑位置</td>
<td>Ctrl + Shift + Backspace</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>高亮显示选中文字</td>
<td>Ctrl + Shift + F7</td>
<td>F3向下;Shift+F3向上</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="书签操作">书签操作</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>增删书签</td>
<td>F11</td>
<td>在当前行添加或删除书签</td>
<td></td>
</tr>
<tr>
<td></td>
<td>增删具名书签</td>
<td>Ctrl + F11</td>
<td>在当前行添加或删除书签，可用一位数字或字母命名</td>
<td></td>
</tr>
<tr>
<td></td>
<td>书签跳转</td>
<td>Shift + F11</td>
<td>在列表中选择或使用具名书签的编号快速切换</td>
<td></td>
</tr>
<tr>
<td></td>
<td>跳转至前/后一个书签</td>
<td>-</td>
<td>需在KeyMap中自定义，建议设置</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="基本操作">基本操作</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>快速切回编辑区</td>
<td>ESC</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>快速切换方案</td>
<td>Ctrl + ~</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>还原默认布局</td>
<td>Shift + F12</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>隐藏/恢复所有窗口</td>
<td>Ctrl + Shift + F12</td>
<td>往往与ESC配合使用，快速切回编辑区再隐藏其他窗口</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="查找/替换">查找/替换</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>高亮显示选中文字</td>
<td>Ctrl + N</td>
<td>可以打开类时直接跳转到某行</td>
<td></td>
</tr>
<tr>
<td></td>
<td>替换文本</td>
<td>Ctrl + R</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>全局替换</td>
<td>Ctrl + Shift + R</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>查找文本</td>
<td>Ctrl + F</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>全局查找</td>
<td>Ctrl + Shift + F</td>
<td>-</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="编辑">编辑</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>显示文档</td>
<td>Ctrl + Q</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>显示参数</td>
<td>Ctrl + P</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>复制行</td>
<td>Ctrl + D</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>格式化代码</td>
<td>Ctrl + Alt + L</td>
<td>可以优化导入包</td>
<td></td>
</tr>
<tr>
<td></td>
<td>多行编辑</td>
<td>Alt + Shift + Mouse1</td>
<td>像Sublime Text一样的多行编辑功能</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="编译/调试">编译/调试</h5><table>
<thead>
<tr>
<th></th>
<th></th>
<th>Intellij IDEA</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>Run last</td>
<td>Shift + F10</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Run…</td>
<td>Alt + Shift + F10</td>
<td>在菜单中选择</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Debug last</td>
<td>Shift + F9</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Debug…</td>
<td>Alt + Shift + F9</td>
<td>在菜单中选择</td>
<td></td>
</tr>
<tr>
<td></td>
<td>step over</td>
<td>F8</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>step into</td>
<td>F7</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Resume</td>
<td>F9</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td></td>
<td>step out</td>
<td>Shift + F8</td>
<td>-</td>
<td></td>
</tr>
</tbody>
</table>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/18/Kettle组件错误处理/" title="Kettle组件错误处理" itemprop="url">Kettle组件错误处理</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-05-18T09:19:02.000Z" itemprop="datePublished"> 发表于 2015-05-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Kettle于<strong>2.4.1-M1</strong>版本引入错误处理特性。如下图所示，支持错误处理的组件可以向后拖拽出一条红色的线条。当出现错误数据时不会抛出异常终止step，而是将出错行沿着红线向后发送。</p>
<p><img src="/img/kettle_errorhandle_01.png" alt="错误处理连线"></p>
<p>右击组件选择Define error handling…（或者单击红色错误连线上的叉图标），打开错误处理设置界面:</p>
<p><img src="/img/kettle_errorhandle_02.png" alt="错误处理配置界面"></p>
<p> <strong>主要配置项</strong>:</p>
<ul>
<li>nrErros: （本轮）发生错误行数，绝大多数组件为1</li>
<li>errorDescription: 错误堆栈信息</li>
<li>errorField: 错误列名；本例中为空因为在表输出组件实现中，jdbc发生错误时没有办法通过JDBC Driver获取具体的出错数据库列名。其他组件是否有值取决于具体的后台实现。</li>
<li>errorCode: 错误码，由组件约定；比如表输出组件的TOP001表示常规数据库错误</li>
</ul>
<p><strong>Note:</strong> 这四个列会被后续组件获取到</p>
<h2 id="组件开发：支持错误处理">组件开发：支持错误处理</h2><ol>
<li>在组件Meta实现类中覆盖基类中的supportsErrorHandling()方法，返回true</li>
<li>后台逻辑实现</li>
</ol>
<p>通过一个boolean变量标记组件是否启用错误处理模式(后面连着红线)，可在构造方法中初始化<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> sendToErrorRow = getStepMeta().isDoingErrorHandling();</span><br></pre></td></tr></table></figure></p>
<p>在行处理逻辑附近，catch块中进行putError()的调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(sendToErrorRow) &#123;</span><br><span class="line">    putError( getInputRowMeta(), r, <span class="number">1</span>, e.toString(), <span class="keyword">null</span>, <span class="string">"ExchangeFileInput001"</span> );</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logError( BaseMessages.getString(PKG, <span class="string">"ExchangeFile.ErrorInStepRunning"</span>, e.getMessage()) );</span><br><span class="line">    setErrors( <span class="number">1</span> );</span><br><span class="line">    stopAll();</span><br><span class="line">    setOutputDone(); <span class="comment">// signal end to receiver(s)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参考文档">参考文档</h2><p><a href="http://www.ibridge.be/?p=32" target="_blank" rel="external">Matt的博客</a><br><a href="http://wiki.pentaho.com/display/COM/Step+error+handling+codes" target="_blank" rel="external">Step error handling codes</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/AETL/">AETL</a><a href="/tags/Kettle/">Kettle</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/18/H2数据库使用/" title="H2数据库使用" itemprop="url">H2数据库使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-05-18T08:54:45.000Z" itemprop="datePublished"> 发表于 2015-05-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="H2的几种运行方式：">H2的几种运行方式：</h2><ol>
<li>作为内存数据库使用<ul>
<li>jdbc url配置：<kbd>jdbc:h2:mem:<dbname></dbname></kbd></li>
</ul>
</li>
<li>作为持久化数据库<ul>
<li>jdbc url配置：<kbd>jdbc:h2:file:<path_to_dbfile></path_to_dbfile></kbd></li>
</ul>
</li>
<li>以Server方式启动<ul>
<li>默认方式（此时数据库端口默认为9092）； java -cp h2.jar org.h2.tools.Server</li>
<li>指定数据库端口：java -cp h2.jar org.h2.tools.Server -tcp -tcpPort 6006</li>
<li>jdbc url配置：<kbd>jdbc:h2:tcp://<ip>:<port>/mem:<dbname></dbname></port></ip></kbd><br>或<kbd>jdbc:h2:tcp://<ip>:<port>/file:<path_to_dbfile></path_to_dbfile></port></ip></kbd></li>
</ul>
</li>
</ol>
<p>综述：前两种连接为嵌入式模式，只有单进程能访问；第三种可以多进程访问</p>
<h2 id="H2在Kettle/AETL中的数据库连接配置：">H2在Kettle/AETL中的数据库连接配置：</h2><p>1.作为嵌入式数据库使用(内存或磁盘)</p>
<p><kbd>数据库名称</kbd>以<strong>mem:</strong>或<strong>file:</strong>开头，例如 file:E:/workspace3/adxp//db/agentDb<br><kbd>主机名称</kbd>和<kbd>端口号</kbd>必须留空</p>
<p>2.作为C/S模式使用</p>
<p><kbd>主机名称</kbd>填ip(一般填localhost)，<kbd>端口号</kbd>填写端口（AETL启动使用默认端口9092）；<br><kbd>数据库名称</kbd>填写数据库的名称比如logdb</p>
<p> <strong>Note:</strong></p>
<ul>
<li>原AETL使用h2的1.2.131版本，当前升级至最新稳定版1.3.176</li>
<li>自1.4.177版本起，H2的数据库文件默认使用新的MVStore格式，形如 <strong>xxx.mv.db</strong>; 之前版本的数据库文件为<strong>xxx.h2.db</strong>;如若禁用，须在jdbc url后面添加 <strong>;MV_STORE=FALSE</strong> 和 <strong>;MVCC=FALSE</strong></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/H2/">H2</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/08/ADXP文件传输的校验逻辑设计/" title="ADXP文件传输的接收校验逻辑设计" itemprop="url">ADXP文件传输的接收校验逻辑设计</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2015-04-08T01:55:00.000Z" itemprop="datePublished"> 发表于 2015-04-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="问题">问题</h2><p>首先确认一下本文要解决的问题：ADXP的文件传输是将文件分为若干小块进行块传输。在传输过程中，可能因为网络问题而发生文件块的丢失、乱序或者错误。当传输完成时，发送端与接收端会对整个文件做一次MD5比对，若MD5不同，说明接收过程中发生了错误。</p>
<p>问题在于这时文件位于网络中两台不同的机器上，无法确认具体是哪些快出现了问题。因此需要使用一个类似rsync的算法，在两边文件见不到面时确认哪些块不同。</p>
<h2 id="校验流程">校验流程</h2><ul>
<li><strong>分块</strong> 首先把接收端接收到的文件平均分成若干个小块，比如每块2048个字节(最后一块会小于等于2048字节)，然后对每块计算MD5</li>
<li><strong>传输</strong> 接收端会将上述MD5列表传送到文件发送端。当发送端在拿到列表时，也会以同样的过程生成这个列表</li>
<li><strong>查找</strong> 发送端获得列表后，会把数据存到一个以MD5为key的哈希表中，以便获得O(1)时间复杂度的查找性能</li>
<li><p><strong>比对</strong> 此时比较源列表与目标列表中MD5的<strong>差集</strong>，便可以知道所有需要重传的文件块。这里用HashSet简单示意如下：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; s1 = Sets.newHashSet(<span class="string">"md1"</span>, <span class="string">"md2"</span>, <span class="string">"md3"</span>, <span class="string">"md4"</span>, <span class="string">"md5"</span>);</span><br><span class="line">Set&lt;String&gt; s2 = Sets.newHashSet(<span class="string">"md1"</span>, <span class="string">"md2"</span>, <span class="string">"md4"</span>, <span class="string">"m5d"</span>); <span class="comment">// 模拟传输中丢失块3，块5有内容错误</span></span><br><span class="line">s1.removeAll(s2);</span><br><span class="line">System.out.println(Arrays.toString(s1.toArray())); <span class="comment">// out: "md3" "md5"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><strong>Note:</strong> 样例代码有所简化，实际中是将MD5与位置属性(比如文件块首尾位置)结合为一个模型对象，实现equals()和hashcode(); Set中存储这个对象即可</p>
</blockquote>
<ul>
<li><strong>缓存</strong><br>  在上述伪代码中，调用s1.removeAll(s2)时会修改掉s1本身。考虑到可能的重复校验多次情况，每次都要重新生成源文件的MD5列表会引起额外开销，可以引入缓存进行优化(Guava cache或Ehcache等)。这时需要在比对过程中不修改源端列表s1的内容。这样s1便可以被缓存至传输流程结束。  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; s1 = Sets.newHashSet(<span class="string">"md1"</span>, <span class="string">"md2"</span>, <span class="string">"md3"</span>, <span class="string">"md4"</span>, <span class="string">"md5"</span>);</span><br><span class="line">Set&lt;String&gt; s2 = Sets.newHashSet(<span class="string">"md1"</span>, <span class="string">"md2"</span>, <span class="string">"md4"</span>, <span class="string">"m5d"</span>); <span class="comment">// lost 3 and dismatch 5</span></span><br><span class="line">Set&lt;String&gt; result = Sets.difference(s1, s2); <span class="comment">// Guava的API返回一个视图，而不是修改集合s1本身</span></span><br><span class="line">System.out.println(Arrays.toString(result.toArray())); <span class="comment">// out: "md3" "md5"</span></span><br><span class="line">System.out.println(Arrays.toString(s1.toArray())); <span class="comment">// out: "md1", "md2", "md3", "md4", "md5"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="其他相关">其他相关</h2><p>在文件传送过程中，我们需要一个用以做标记的数据结构：<br>它应该对下面操作做到尽可能的高效：</p>
<ul>
<li>接收到一组文件块，快速做出标记，表示其已收到</li>
<li>快速统计出当前接收到的文件块总数</li>
<li>快速定位到哪个（哪些个）文件块尚未收到</li>
</ul>
<p>简单思路是，若源端文件被分成比如1000个块，目标端建立一个长度为1000的boolean数据用于标记，接收到文件块时，根据其位置信息快速定位到相应的数组下标，并置为true。这样可以分别以O(1), O(n), O(n)的时间复杂度满足上述三个需求。</p>
<p>以boolean数组为基础，可以进一步的简化：如果能以一串二进制01来标记对应的文件块是否收到，这样可以将内存占用降低到极致。在JDK中正巧有类似的实现java.util.BitSet，不过略微不同的是，BitSet内部实际上以length为 位数&gt;&gt;6 的long数组来存储。另外，用于统计true总数的API cardinality() 由于高效率的位运算实现，遍历次数可以降低为朴素循环遍历的1/64</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/17/LeetCode-Reverse-Integer/" title="LeetCode: Reverse Integer" itemprop="url">LeetCode: Reverse Integer</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2014-06-17T06:31:23.000Z" itemprop="datePublished"> 发表于 2014-06-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Reverse digits of an integer.</p>
<p>Example1: x = 123, return 321<br><br>Example2: x = -123, return -321</p>
<hr>
<p>递归处理，代码可以写的很优雅</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> neg = x &lt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (neg) x = -x;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">0</span>) &#123;</span><br><span class="line">        result = result * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">        x /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (neg ? -<span class="number">1</span> : <span class="number">1</span>) * result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/leetcode/">leetcode</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/algorithm/">algorithm</a><a href="/tags/leetcode/">leetcode</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/17/LeetCode-String-to-Integer-(atoi)/" title="LeetCode: String to Integer (atoi)" itemprop="url">LeetCode: String to Integer (atoi)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2014-06-17T06:24:42.000Z" itemprop="datePublished"> 发表于 2014-06-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Implement atoi to convert a string to an integer.</p>
<p>Hint: Carefully consider all possible input cases. If you want a challenge, please do not see below and ask yourself what are the possible input cases.</p>
<p>Notes: It is intended for this problem to be specified vaguely (ie, no given input specs). You are responsible to gather all the input requirements up front.</p>
<hr>
<p>很基础且常见的面试题，更多的是考察能否把所有情况考虑周全，注意到以下几点即可AC</p>
<ol>
<li><p>这个字符串是否为空。</p>
</li>
<li><p>这个字符串是否有非法字符（非0-9之间的字符）。</p>
</li>
<li><p>这个数是正数或者是负数的情况（第一个字符是否为+，-）。</p>
</li>
<li><p>是否存在溢出的情况（这个比较难考虑到）。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">atoi</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span> || str.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span> hasSymbol = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> negative = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">char</span>[] c = str.trim().toCharArray();</span><br><span class="line">    <span class="keyword">if</span> (c[<span class="number">0</span>] == <span class="string">'+'</span> || c[<span class="number">0</span>] == <span class="string">'-'</span>) &#123;</span><br><span class="line">        hasSymbol = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (c[<span class="number">0</span>] == <span class="string">'-'</span>) negative = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = hasSymbol ? <span class="number">1</span> : <span class="number">0</span>; i &lt; c.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c[i] &lt; <span class="string">'0'</span> || c[i] &gt; <span class="string">'9'</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result = result * <span class="number">10</span> + c[i] - (<span class="string">'9'</span> - <span class="number">9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result &gt; <span class="number">2147483647</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> negative ? -<span class="number">2147483648</span> : <span class="number">2147483647</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (negative ? -<span class="number">1</span> * result : result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/leetcode/">leetcode</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/algorithm/">algorithm</a><a href="/tags/leetcode/">leetcode</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/16/LeetCode-Median-of-Two-Sorted-Arrays/" title="LeetCode: Median of Two Sorted Arrays" itemprop="url">LeetCode: Median of Two Sorted Arrays</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2014-06-16T10:20:31.000Z" itemprop="datePublished"> 发表于 2014-06-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>There are two sorted arrays A and B of size m and n respectively. Find the median of the two sorted arrays. The overall run time complexity should be O(log (m+n)).</p>
<hr>
<p>找到两个有序数组的中位数，LeetCode第二题，但是难度远大于第一题</p>
<p>正常思路会想到，将两个数组归并，返回中间数。归并操作耗时O(m+n),显然达不到题目要求。<br>那么就要深挖题目中的条件。数组有序，往往会联想到二分的思路，每次排除掉一半的结果集。在这道题中，可以利用“寻找第k小的数”的思路，这样本题转化为寻找第(m+n)/2小的数：</p>
<p>先来看下两个有序数组中，寻找第k小的数的做法:<br>不妨假设两个数组升序排列，且长度均大于k/2，则我们比较AB中第k/2个数的大小，有如下几种情况:<br></p>
<ul>
<li>A[k/2-1] &lt; B[k/2-1]</li>
<li>A[k/2-1] &lt; B[k/2-1]</li>
<li>A[k/2-1] &lt; B[k/2-1]</li>
</ul>
<p>当A[k/2-1] &lt; B[k/2-1]时，在AB数组归并后，A[0]至A[k/2-1]之间的数必定都在B[k/2-1]的左边，也就是说我们可以排除掉这么长一段结果集，继续在剩下的元素组成的序列中寻找第(k - k/2)大小的数。<br>由于每次排除掉k/2，也就是(m+n)/4大小的结果集，所以此方式下，时间复杂度为O(log(m+n))</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">findMedianSortedArrays</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> B[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = A.length + B.length;</span><br><span class="line">    <span class="keyword">if</span> (sum % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> findKth(A, <span class="number">0</span>, A.length - <span class="number">1</span>, B, <span class="number">0</span>, B.length - <span class="number">1</span>, sum / <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (findKth(A, <span class="number">0</span>, A.length - <span class="number">1</span>, B, <span class="number">0</span>, B.length - <span class="number">1</span>, sum / <span class="number">2</span>)</span><br><span class="line">                + findKth(A, <span class="number">0</span>, A.length - <span class="number">1</span>, B, <span class="number">0</span>, B.length - <span class="number">1</span>, sum / <span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">        ) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findKth</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> startA, <span class="keyword">int</span> endA,</span><br><span class="line">                    <span class="keyword">int</span> B[], <span class="keyword">int</span> startB, <span class="keyword">int</span> endB,</span><br><span class="line">                    <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = endA - startA + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> n = endB - startB + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m &gt; n) <span class="keyword">return</span> findKth(B, startB, endB, A, startA, endA, k); <span class="comment">//只考虑a &lt;= b的情况</span></span><br><span class="line">    <span class="keyword">if</span> (m &lt; <span class="number">1</span>) <span class="keyword">return</span> B[startB + k - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">1</span>) <span class="keyword">return</span> Math.min(A[startA], B[startB]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> midA = Math.min(k / <span class="number">2</span>, m), midB = k - midA;</span><br><span class="line">    <span class="comment">//如果a的第midA大的元素比b的第midB大的元素小，</span></span><br><span class="line">    <span class="comment">//那么删掉a的前midA个元素，在剩余的数中找第k-midA大的。</span></span><br><span class="line">    <span class="keyword">if</span> (A[startA + midA - <span class="number">1</span>] &lt; B[startB + midB - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> findKth(A, startA + midA, endA, B, startB, endB, k - midA);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (A[startA + midA - <span class="number">1</span>] &gt; B[startB + midB - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> findKth(A, startA, endA, B, startB + midB, endB, k - midB);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> A[startA + midA - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/leetcode/">leetcode</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/algorithm/">algorithm</a><a href="/tags/leetcode/">leetcode</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/16/LeetCode-Add-Two-Numbers/" title="LeetCode: Add Two Numbers" itemprop="url">LeetCode: Add Two Numbers</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="lyt" target="_blank" itemprop="author">lyt</a>
		
  <p class="article-time">
    <time datetime="2014-06-16T09:57:42.000Z" itemprop="datePublished"> 发表于 2014-06-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>You are given two linked lists representing two non-negative numbers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.</p>
<p><strong>Input:</strong> (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br><br><strong>Output:</strong> 7 -&gt; 0 -&gt; 8</p>
<p>很基础的链表操作题目，一次循环依次对节点进行加法运算即可，要注意进位与边界条件，时间复杂度O(n)</p>
<p>为了可理解性，在我的实现中把加法与进位运算拆开分别处理了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="keyword">null</span> || l2 == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> l1 == <span class="keyword">null</span> ? l2 : l1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListNode p = <span class="keyword">new</span> ListNode(l1.val + l2.val);</span><br><span class="line">    ListNode head = p;</span><br><span class="line">    <span class="keyword">while</span> (l1.next != <span class="keyword">null</span> &amp;&amp; l2.next != <span class="keyword">null</span>) &#123; <span class="comment">// 加法操作</span></span><br><span class="line">        l1 = l1.next;</span><br><span class="line">        l2 = l2.next;</span><br><span class="line">        p.next = <span class="keyword">new</span> ListNode(l1.val + l2.val);</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    l1 = l1.next;</span><br><span class="line">    l2 = l2.next;</span><br><span class="line">    p.next = l1 == <span class="keyword">null</span> ? l2 : l1;</span><br><span class="line"></span><br><span class="line">    p = head;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123; <span class="comment">// 处理进位</span></span><br><span class="line">        <span class="keyword">if</span> (p.val &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">                p.next = <span class="keyword">new</span> ListNode(p.val / <span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p.next.val += p.val / <span class="number">10</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p.val %= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/leetcode/">leetcode</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/algorithm/">algorithm</a><a href="/tags/leetcode/">leetcode</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/blog/" title="blog">blog<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/leetcode/" title="leetcode">leetcode<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/leetcode/" title="leetcode">leetcode<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/algorithm/" title="algorithm">algorithm<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Kafka/" title="Kafka">Kafka<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Kettle/" title="Kettle">Kettle<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/AETL/" title="AETL">AETL<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/article/" title="article">article<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/H2/" title="H2">H2<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, This is my blog on Github. <br/>
			</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1951093517" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="lyt">lyt</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
